datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id         Int      @id @default(autoincrement())
  firstName  String
  lastName   String
  patronymic String?
  phone      String
  login      String   @unique
  password   String
  type       String 

  comments   Comment[]

  masterRequests Request[] @relation("MasterRequests")

  clientRequests Request[] @relation("ClientRequests")

  managerRequests Request[] @relation("ManagerRequests")
}

model Request {
  id               Int       @id @default(autoincrement())
  startDate        DateTime  @default(now())
  orgTechType      String
  orgTechModel     String
  problemDescryption String
  requestStatus    String
  completionDate   DateTime?
  repairParts      String?

  master    User?   @relation("MasterRequests", fields: [masterId], references: [id], onDelete: SetNull)
  masterId  Int?

  client    User    @relation("ClientRequests", fields: [clientId], references: [id], onDelete: Cascade)
  clientId  Int

  manager   User?   @relation("ManagerRequests", fields: [managerId], references: [id], onDelete: SetNull)
  managerId Int?

  comments  Comment[]
}

model Comment {
  id        Int      @id @default(autoincrement())
  message   String

  master    User     @relation(fields: [masterId], references: [id], onDelete: Cascade)
  masterId  Int

  request   Request  @relation(fields: [requestId], references: [id], onDelete: Cascade)
  requestId Int
}
